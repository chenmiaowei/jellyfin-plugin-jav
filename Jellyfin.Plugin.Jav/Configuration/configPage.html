<!DOCTYPE html>
<html lang="zh">

<head>
    <title>Jav</title>
</head>

<body>
<div data-role="page" id="JavPluginConfigurationPage" class="page type-interior pluginConfigurationPage " data-require="emby-input,emby-button,emby-select,emby-checkbox,emby-linkbutton,emby-collapse">
    <div data-role="content">
        <div class="content-primary">

            <div class="verticalSection verticalSection">
                <div class="sectionTitleContainer flex align-items-center">
                    <h2 class="sectionTitle">Jav</h2><span id="current_version" is="emby-linkbutton" class="emby-button"></span>
                    <a is="emby-linkbutton" class="raised button-alt headerHelpButton emby-button" target="_blank" href="https://github.com/chenqiaoanying/jellyfin-plugin-jav">源码</a>
                </div>
            </div>

            <div class="readOnlyContent">
                <p class="description1">
                    日本电影刮削器插件，用于从某些网站采集影片信息。
                    <a is="emby-linkbutton" target="_blank" href="https://javscraper.com/" class="button-link emby-button">了解更多</a>
                </p>
            </div>

            <form id="JavPluginConfigurationForm">

                <fieldset class="verticalSection">
                    <legend><h2>服务器配置</h2></legend>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtServer">服务器地址:</label>
                        <input id="txtServer" is="emby-input" pattern="^https?://.+$" required type="text"/>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtToken">令牌:</label>
                        <input id="txtToken" is="emby-input" type="text"/>
                        <div class="fieldDescription">如果未设置请留空</div>
                    </div>
                </fieldset>

                <fieldset class="verticalSection">
                    <legend><h2>通用配置</h2></legend>
                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtImageQuality">图片质量:</label>
                        <input id="txtImageQuality" is="emby-input" required type="number"/>
                        <div class="fieldDescription">JPEF图片质量，在 0-100 之间</div>
                    </div>
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input id="chkEnableCollectionsBySeries" is="emby-checkbox" type="checkbox"/>
                            <span>根据系列生成合集</span>
                        </label>
                    </div>
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" is="emby-checkbox" id="chkEnableChineseSubtitleGenre">
                            <span>根据文件名增加“中文字幕”标签</span>
                        </label>
                    </div>
                </fieldset>

                <fieldset class="verticalSection">
                    <legend><h2>格式</h2></legend>
                    <div class="inputContainer">
                        <label class="inputLabel inputLabel-float inputLabelUnfocused" for="txtTitleTemplate">标题格式:</label>
                        <input is="emby-input" type="text" id="txtTitleTemplate" class="emby-input">
                    </div>
                    <div class="inputContainer">
                        <label class="inputLabel inputLabel-float inputLabelUnfocused" for="txtTaglineTemplate">标签行格式:</label>
                        <input is="emby-input" type="text" id="txtTaglineTemplate" class="emby-input">
                    </div>
                    <div class="inputContainer">
                        <label class="inputLabel inputLabel-float inputLabelUnfocused" for="txtPlaceHolderIfNull">若参数为空时，则显示为:</label>
                        <input is="emby-input" type="text" id="txtPlaceHolderIfNull" class="emby-input">
                    </div>
                    <div>
                        <b>支持的参数列表:</b>
                        <ul>
                            <li>{num} : 番号</li>
                            <li>{title} : 标题</li>
                            <li>{actors} : 演员</li>
                            <li>{first_actor} : 第一个演员</li>
                            <li>{set} : 系列</li>
                            <li>{director} : 导演</li>
                            <li>{date} : 发行日期</li>
                            <li>{year} : 发行年份</li>
                            <li>{month} : 发行月份</li>
                            <li>{studio} : 制作组</li>
                            <li>{label} : 厂商</li>
                            <li>{genre:A?B:C} : 类别。当存在类别A时值为B，否则值为C；B和C可以为空。示例 {genre:中文字幕?中文:}</li>
                        </ul>
                    </div>
                </fieldset>

                <!--<fieldset class="verticalSection">
                    <legend><h2>女优头像</h2></legend>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" is="emby-checkbox" id="chkEnableCutPersonImage">
                            <span>按比例剪裁女优头像</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription"></div>
                    </div>
                    <div class="fieldDescription">按比例剪裁能让头像在 Jellyfin 中显示不变形，但会有部分内容被裁掉。女优头像数据源来自 <a is="emby-linkbutton" class="button-link lnkSupporterLearnMore emby-button" href="https://github.com/xinxin8816/gfriends" target="_blank">女友头像仓库</a>。</div>

                    <br>
                    <div class="description1">
                        <b>立即采集缺失的女优头像</b>：请到 <a data-navmenuid='/scheduledtasks' is='emby-linkbutton' class='button-link emby-button' href='/scheduledtasks' title=' 高级 - 计划任务 - JavScraper '> 高级 - 计划任务 - JavScraper </a> 中找到 <b>JavScraper: 立即采集缺失的女优头像</b>，点击右边的 <i class="md-icon">play_arrow</i> 开始执行。
                    </div>
                </fieldset>-->

                <!--<fieldset class="verticalSection">
                    <legend><h2>翻译</h2></legend>
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" is="emby-checkbox" id="chkEnableBaiduFanyi">
                            <span>启用</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription"></div>
                    </div>
                    <div class="selectContainer">
                        <label class="selectLabel" for="selectBaiduFanyiLanguage">目标语言：</label>
                        <select is="emby-select" id="selectBaiduFanyiLanguage" class="selectBaiduFanyiLanguage emby-select-withcolor emby-select">
                            <option value="zh">中文</option>
                            <option value="cht">繁体中文</option>
                            <option value="en">英文</option>
                        </select>
                        <div class="selectArrowContainer">
                            <div style="visibility:hidden;display:none;">0</div>
                            <span class="selectArrow material-icons keyboard_arrow_down"></span>
                        </div>
                    </div>
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" is="emby-checkbox" id="chkEnableBaiduFanyiOptionsName">
                            <span>标题</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription"></div>
                    </div>
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" is="emby-checkbox" id="chkEnableBaiduFanyiOptionsGenre">
                            <span>类别 （不推荐）</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription"></div>
                    </div>
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" is="emby-checkbox" id="chkEnableBaiduFanyiOptionsPlot">
                            <span>简介</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription"></div>
                    </div>
                </fieldset>-->

                <fieldset class="verticalSection">
                    <legend><h2>文本替换</h2></legend>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" is="emby-checkbox" id="chkEnableGenreReplacement">
                            <span>开启类别替换</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription"></div>
                    </div>
                    <div class="inputContainer">
                        <label class="inputLabel inputLabel-float inputLabelUnfocused" for="txtRawGenreReplacementTable">类别替换表:</label>
                        <textarea rows="10" is="emby-input" type="text" id="txtRawGenreReplacementTable" class="emby-input"></textarea>
                        <div class="fieldDescription"></div>
                    </div>
                    <div class="fieldDescription">该功能优先级高于百度翻译中的类别翻译项。每行一条记录，两个类别之间用小写的冒号隔开，当目标类别为空白时，表示去除该类别。</div>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" is="emby-checkbox" id="chkEnableActorReplacement">
                            <span>开启演员姓名替换</span>
                        </label>
                        <div class="fieldDescription checkboxFieldDescription"></div>
                    </div>
                    <div class="inputContainer">
                        <label class="inputLabel inputLabel-float inputLabelUnfocused" for="txtRawActorReplacementTable">演员姓名替换表:</label>
                        <textarea rows="10" is="emby-input" type="text" id="txtRawActorReplacementTable" class="emby-input"></textarea>
                        <div class="fieldDescription"></div>
                    </div>
                    <div class="fieldDescription">每行一条记录，两个演员姓名之间用小写的冒号隔开，当目标演员姓名为空白时，表示去除该演员姓名。</div>
                </fieldset>

                <div>
                    <button is="emby-button" type="submit" class="raised button-submit block emby-button"><span>保存</span></button>
                </div>
            </form>
        </div>
    </div>
    <script type="text/javascript">
        var JavPluginConfiguration = {
            pluginUniqueId: "f524e754-dfbc-4604-95ac-561e9cb5a383"
        };

        $('#JavPluginConfigurationPage').on('pageshow', function (event) {
            Dashboard.showLoadingMsg();
            ApiClient.getPluginConfiguration(JavPluginConfiguration.pluginUniqueId).then(function (config) {
                $('#current_version').text("v" + config.Version);

                $('#txtServer').val(config.Backend.Server).change();
                $('#txtToken').val(config.Backend.Token).change();

                $('#txtImageQuality').val(config.General.ImageQuality).change()
                document.querySelector('#chkEnableChineseSubtitleGenre').checked = config.General.EnableChineseSubtitleGenre;
                document.querySelector('#chkEnableCollectionsBySeries').checked = config.General.EnableCollectionsBySeries;

                $('#txtTitleTemplate').val(config.Template.TitleTemplate).change();
                $('#txtTaglineTemplate').val(config.Template.TaglineTemplate).change();
                $('#txtPlaceHolderIfNull').val(config.Template.PlaceHolderIfNull).change();

                document.querySelector('#chkEnableGenreReplacement').checked = config.Replacement.EnableGenreReplacement;
                $('#txtRawGenreReplacementTable').val(config.Replacement.RawGenreReplacementTable).change();
                document.querySelector('#chkEnableActorReplacement').checked = config.Replacement.EnableActorReplacement;
                $('#txtRawActorReplacementTable').val(config.Replacement.RawActorReplacementTable ).change();

                Dashboard.hideLoadingMsg();
            });
        });

        $('#JavPluginConfigurationForm').on('submit', function (e) {
            Dashboard.showLoadingMsg();
            ApiClient.getPluginConfiguration(JavPluginConfiguration.pluginUniqueId).then(function (config) {
                config.Backend.Server = $('#txtServer').val();
                config.Backend.Token = $('#txtToken').val();

                config.General.ImageQuality = $('#txtImageQuality').val();
                config.General.EnableChineseSubtitleGenre = $('#chkEnableChineseSubtitleGenre').prop('checked');
                config.General.EnableCollectionsBySeries = $('#chkEnableCollectionsBySeries').prop('checked');

                config.Template.TitleTemplate = $('#txtTitleTemplate').val();
                config.Template.TaglineTemplate = $('#txtTaglineTemplate').val();
                config.Template.PlaceHolderIfNull = $('#txtPlaceHolderIfNull').val();

                config.Replacement.EnableGenreReplacement = $('#chkEnableGenreReplacement').prop('checked');
                config.Replacement.RawGenreReplacementTable = $('#txtRawGenreReplacementTable').val();
                config.Replacement.EnableActorReplacement = $('#chkEnableActorReplacement').prop('checked');
                config.Replacement.RawActorReplacementTable = $('#txtRawActorReplacementTable').val();

                ApiClient.updatePluginConfiguration(JavPluginConfiguration.pluginUniqueId, config)
                    .then(Dashboard.processPluginConfigurationUpdateResult);
            });
            return false;
        });
    </script>
</div>
</body>
</html>
